<!DOCTYPE html>
<!-- Si estas por aqui, eres un/a stalker, o de plano medio curioso/a en todo caso -->
<!-- No uso auto generadores estaticos, me gusta escribir todo esto asi a mano, mega OCD -->
<html>
    <head>
        <title>ðŸ—‘</title>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="description" content="My dump">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="./static/vendors/css/highlight.min.css" />
        <style>
            body {font-family: monospace; background: crimson;}
            header{margin-bottom: 15px;}
            .pre-code {
                box-shadow: 2px 4px black;
                border: 2px groove black;
                white-space: pre;
                background: whitesmoke; 
                padding:5px; 
                overflow: auto; 
                line-height: 1.5}
            #title{color: white;background-color:rgba(0,0,255,.50);}
            .snake-style{color:limegreen;background:black;border:1px solid crimson;}
            .warning-style{color:yellow;background:black;border:1px solid yellow;}
            .happy-style{color:limegreen;background:blue;border:1px solid limegreen;}
            .trans-style{color: white; background: pink; border: 3px solid lightblue;}
            .block-of-code{background: black; border 1px solid crimson; width: auto; overflow: auto;}
            .block-of-code code {color: white; overflow: auto; width:auto; display: block;}
            .main-nav{height: 20px; background: black;}
            .nav-link{color: white; background: black; border: 1px dashed black;
                margin-right: 18px;}
            .nav-link:not(:first-of-type){margin-left: 0px;}
            .sticky{ width: 100%; position: fixed; top:2;}
            .note{color: white; background-color: rgba(0,0,0,0.51); box-shadow: 3px
                6px black; border: 2px solid black;
                margin-bottom: 20px;}
            .note-title{padding:0px 10px 10px 10px;}
            .note-body{padding:0px 10px 10px 10px;}
            .note-dark{color: white; background-color: rgba(0,0,0,0.51); box-shadow: 3px
                6px dark; border: 2px solid crimson;
                margin-bottom: 20px;}
            .counter{margin-bottom: 10px;}
            .counter div {background: white; padding: 3px; border: 3px solid
                black}
            .flex{display: flex;}
            .flex-row{flex-direction: row;}
            .space-between{justify-content: space-between;}
            .signature-right{
                padding:0; margin:0; 
                border-left: 2px solid black; 
                border-bottom: 2px solid black;
                background: black;
            }
            .signature-left{
                padding:0; 
                margin:0; 
                border-right: 2px solid black; 
                border-bottom: 2px solid black;
                background: black;
            }
            #loading {
                display: block;
                position: absolute;
                top: 0;left: 0;z-index: 100;
                width: 100vw;
                height: 100vh;
            }
            #page {
                display: none;
            }
            #loading-image{
                height: 100px;
                width: 100px;
            }
            #howdy-cowgirl span{
                margin: 0;
                padding:0;
            }
        </style>
        <script>
            function onReady(callback) {
                var id = window.setInterval(c1, 1000);
                function c1() {
                    if (document.getElementsByTagName('body')[0] !== undefined) {
                        window.clearInterval(id);
                        callback.call(this);
                    }
                }
            }

            function s1(id, value) {
                document
                    .getElementById(id)
                    .style
                    .display = value ? 'block' : 'none';
            }

            onReady(function () {
                s1('page', true);
                s1('loading', false);
            });
        </script>
    </head>
    <body id="page">
        <div id="loading"></div>
        <header style="position: relative;">
            <div class="main-nav">
                <div class="sticky flex flex-row space-between">
                    <div class="nav-link" id="howdy-cowgirl">
                        <span id="g-0">i</span><span id="g-1">T</span><span id="g-2">s</span><span>P</span><span>s</span><span>y</span><span>c</span><span>0</span><span>x</span><span id="g-9">7</span><span>c</span><span>7</span>
                    </div>
                    <div class="nav-link" id="dark-mode-trigger"/> 
                        Dark mOde 
                    </div>
                </div>
            </div>
        </header>
        <!-- notes -->
        <div class="notes">
            <div class="note">
                <div class="note-title">
                    <h3>Deployiong automatic updates to production services.</h3>
                </div>
                <div class="note-body">
                    <p>
                        Normally, in real life situations, services have several
                        environments.
                    </p>
                    <ol>
                        <li>Testing</li>
                        <li>Staging/Development</li>
                        <li>Stable/Production</li>
                    </ol>
                     <small>The naming may differ</small>
                     <p> The purpose of the testing environment, server, is for the
                     person who is working on pull request code reviews. To pull
                     test, do QA, make suggestions, etc.
                     </p>
                     <p>
                     Once these changes are approved, code review passed, unittest
                     pass; on this environment -- perhaps also on a github action on the
                     content integration content delivery workflow, or something
                     similar, the changes are merged on version control into the
                     staging branch, or development branch.
                     </p>
                     <p>
                     Team of management, senior developers, and ocassionally CTO,
                     uses staging environment to review the system before any real
                     push to production, only after the higher ups approve this, then
                     it is time for production updates.
                     </p>
                     <p>
                     Being in charge of production deployments is for experienced
                     individuals, here, the risk is higher, so if you are faint of
                     heart, this is not for you. This is for sadomasochists, sadistic
                     individuals, who enjoy this type of shit. Usually when engineers
                     are told deploy to production, they shit, even, at times, they
                     ghost -- it is during this time, that most show their true face,
                     and others their value.
                     </p>
                     <p>
                     Usually the person in charge wants to automate this process,
                     deploying from a remote version control center like github, can
                     be done in several ways. This is simple way.
                     </p>
                     <p>
                     Assuming you have github action running on version control, that
                     is only triggered when a change is merged into the stable
                     branch, from staging/development branch.
                     </p>
                     <p>
                     Well, a couple of things happen here, one, there is a build job,
                     which tests the installation script, if that passes, there is a
                     unittest job, and if it that passes, there may or may not be a
                     browser automation testing, using tools like pupeeter, or
                     selenium, or there could be tests with zapproxy as well, it
                     really depends on the team.
                     </p>
                     <p>
                        Here is an example of what a automated deployment with version control on github; with checking, looks like.
                     </p>
                     <div class="pre-code"><code>
name: Build Test Deploy

on:
  pull_request:
    branches:
      - main
  workflow_dispatch:

env:
  GITHUB_ACTION: yes
  TEST_BUILD: yes
  TEST_UBUNTU_AGENT: yes
  TEST_CENTOS_AGENT: yes
  TEST_DEPLOY: yes

jobs:
  build:
    runs-on: ubuntu-20.04
    steps:
      - uses: actions/checkout@v2
      - name: Python Setup
        uses: actions/setup-python@v2
        with:
            python-version: '3.8.7'
      - name: System Build
        run: |
          if [[ $TEST_BUILD = no ]]; then
            exit 0
          fi;
          cat << EOF > .env
          SECRET_KEY=238754627jhfsdb
          DB_NAME=production-db
          DB_USER=tubebesita
          DB_PASSWORD=LaMasPerra666
          DB_HOST=172.20.0.11
          DB_PORT=5432
          EMAIL_HOST=
          EMAIL_PORT=4523
          EMAIL_USE_TLS=
          EMAIL_HOST_USER=
          EMAIL_HOST_PASSWORD=
          EOF
          # Setup makes migrations and ensures no migration errors.
          /bin/bash ./setup.sh
  test_agents:
    runs-on: ubuntu-20.04
    needs: [build]
    steps:
      - uses: actions/checkout@v2
      # For using selenium
      - uses: nanasess/setup-chromedriver@v1
      - name: Python Installation
        uses: actions/setup-python@v2
        with:
            python-version: '3.8.7'
      - name: Download Agents
        run: |
          cp tests/ci_cd/scripts/register_download_agents.sh register_download_agents.sh && \
            chmod +x register_download_agents.sh && \
            /bin/bash register_download_agents.sh
      - name: Run Agents
        run: |
          cp tests/ci_cd/scripts/run_linux_agents.sh run_linux_agents.sh && \
            chmod +x run_linux_agents.sh && \
            /bin/bash run_linux_agents.sh
      - name: Agents Step Failure
        if: ${{ failure() }}
        run: |
          echo "yes" >> failure.txt
      - uses: actions/upload-artifact@v3
        with:
          name: linux-agent-tests-job-status-check
          path: |
            failure.txt
  deploy:
    runs-on: ubuntu-20.04
    needs: [build, test_agents]
    steps:
      - uses: actions/checkout@v2
      - name: Python Installation
        uses: actions/setup-python@v2
        with:
            python-version: '3.8.7'
      - uses: actions/download-artifact@v3
        with:
          name: linux-agent-tests-job-status-check
      - name: Deploy
        env:
          HOST_SSH_URL: ${{ secrets.HOST_URL }}
          HOST_USER_NAME: ${{ secrets.HOST_USER_NAME }}
          HOST_SSH_KEY: ${{ secrets.HOST_SSH_KEY }}
        run: |
          if [[ $TEST_DEPLOY = no ]]; then
            exit 0;
          fi
          linux_agents_failures=$(cat failure.txt)
          if [[ linux_agents_failures = yes ]]; then
            echo "[INFO] $(date) Errors on linux agents run";
            exit 1;
          fi
          install -m 600 -D /dev/null ~/.ssh/id_rsa
          echo "$HOST_SSH_KEY" > ~/.ssh/id_rsa
          ssh-keyscan -H "$HOST_URL" > ~/.ssh/known_hosts
          ssh -i  ~/.ssh/id_rsa -l "$HOST_USER_NAME" "$HOST_URL" "cd ~/src/update-repo.sh";</code>
                     </div>
                     <p>
                        This job has three steps, build, test, deploy, simple. At the deploy stage, at the end of the script, the update-repo.sh 
                        script looks similar to this, which pulls the changes from the repository and restart services. it is important to notice update-repo.sh
                        script is located in the machine where the production environment is hosted, it is executed through ssh, so, secrets are needed to be configured 
                        on the repo settings.
                     </p>
                     <div class="pre-code"><code>
#!/bin/bash 
cd ~/project-dir
git pull origin stable
# Run some other tasks pertaining to the application, like a custom version of the ./setup.sh script 
# But one that runs migrations, cleanup scripts, etc.
systemctl restart my-service.service
                     </code></div>
                     <p>
                        You may think, aha, idiot, bullshit, but git asks for a password, trick is is to configure the url origin on the local git repository 
                        config
                     </p>
                     <div class="pre-code"><code>
~$ git remote set-url origin https://your-git-account-name:ghp_this_is_your_github_token@github.com/your-git-account-name/repo-name.git
                     </code></div>
                </div>
            </div>
            <div class="note">
                <div class="note-title">
                    <h3>
                        Deploying Production React app 
                    </h3>
                    <small>
                        Cause React is entrypoint for entry level frontend developers,
                        and it's a popular framework 
                    </small>
                </div>
                <div class="note-body">
                    <p>
                        So, is time to deploy production. You ask frontend team
                        (always arrogant) lead: why deploy instructions dictate only how to run react
                        development build? Where production instructions?
                        You obtain shrugged shoulders and updward palms facing you (IDK expression)
                        
                        <span><img height=15 src="./static/images/gifs/confused.gif" /></span>
                    </p>
                    <p>
                        But when I deploy and see a source tree map of the entire
                        application on the browser development settings, with all the
                        source code for the frontend, PANIC. At the least give the
                        threat actor a bit of trouble by compiling and exposing a single file
                        for the application, not a fucking source code tree map of
                        the application; this, harder to reverse.
                    </p>
                    <p>
                        Ask frontend for solution to do this, they said no idea,
                        probably, because devs just want to turn in job and get paid.
                        Fine.
                    </p>
                    <p>
                        When deploying for production react apps, react is nice
                        enough to let you compile the app in a single build/
                        directory. For not generating source map, a small but *very*
                        important step.
                    </p>
                    <p>
                        Dockerfile for nginx/frontend
                    </p>
                    <div class="pre-code"><code>
#syntax=docker/dockerfile:1
FROM node AS frontend
WORKDIR /frontend
COPY frontend .
RUN yarn install
RUN GENERATE_SOURCEMAP=false npm run build

FROM nginx

RUN rm -rfvd /etc/nginx/conf.d && \
    mkdir -p /usr/share/nginx/html/static && \
    mkdir -p /var/www/html && \
    mkdir -p /etc/nginx/conf.d

COPY --from=frontend /frontend/build /var/www/html
COPY ./docker/nginx/conf.d/default.conf /etc/nginx/conf.d/default.conf</code>
                    </div>
                    <p>
                    The main thing to look at is the RUN step for npm run build;
                    passing environment variable behind it,
                    GENERATE_SOURCEMAP=false does the trick. Multi-stage builds used
                    on the Dockerfile, check docker best practices for advices.
                    <br><br>
                    Seems like small step, but makes big difference; see figure
                    1.2 below
                    </p>
                    <p>
                        No source map tree on production builds, sysadmin can rest
                        better.
                    </p>
                    <div style="width: auto; overflow: auto;">
                        <figure style="margin: 0;">
                            <img src="./static/images/images/step-one.png">
                            <figcaption>Figure 1.1</figcaption>
                        </figure>
                        <br>
                        <figure style="margin: 0;">
                            <img width=auto src="./static/images/images/step-two.png">
                            <figcaption>Figure 1.2</figcaption>
                        </figure>
                    </div>
                    <p>
                        Last thing to do is modify nginx config file so that it can
                        search for that directory, which was copied to /var/www/html
                        inside nginx container (see nginx build stage on Dockerfile)
                    </p>
                    <div class="pre-code"><code>
upstream backend {
    server api:6969 weight=2;
}

server {
    ...
    ...

    location /api/ {
        ...
        ...
        proxy_pass http://backend;
    }

    location / {
        root /var/www/html;
        try_files $uri index.html;
    }

}</code>
                    </div>
                </div>
            </div>
             <div class="note">
                <div class="note-title">
                    <h3>IDK how it's done .. just make something!</h3>
                    <small>and make it reusable, and pluggable!</small>
                </div>
                <div class="note-body">
                    <p>
                        What are distributed applications? That's just a fancy word
                        used by tech bros who want to appear fancy, and can't even
                        get a proper python script running. Anyways, It means, a simple
                        network of interconnected containerized systems ... wow, I
                        sounded just like them, now I have to kill myself!
                    </p>
                    <p>
                        Situation:
                        My boss asks me to deploy several scanners, perhaps 10 open
                        source scanners, and make each avialable via single endpoint,
                        from a 'relayer' rest service.
                        
                        For all other scanners, I add them to a single container,
                        write some wrapper code around it, and set the execution of
                        the wrapper main call for each scanner as an asynchronous
                        function call, using a task queue -- no I don't like hearing
                        myself, the pattern it's just a convention, of sorts, the
                        methods are 'under pressure' methods aka JUST HACK SOMETHING
                        OUT!!!!!
                        <br>
                        <br>
                        But fuck, there is this one .. the one that runs on ruby, and is a
                        pain to configure on the build script for the shared task
                        container; then, it hits well this could be a microservice.
                        <hr>
                    </p>
                    <p>Dockerfile for webcanner container</p>
                    <div class="pre-code"><code>
#syntax=docker/dockerfile:1
FROM ruby:3.0
RUN apt-get update -y && \
    apt-get install -y python3-pip
RUN git clone --recursive https://github.com/urbanadventurer/WhatWeb.git /src
WORKDIR /src
RUN bundle config unset frozen && \
    bundle lock --add-platform x86_64-linux && \
    bundle update && \
    bundle install
# Wrapper api
WORKDIR /
RUN python3 -m pip install flask
COPY ./scanner/api.py /api.py
# Listen 5000 and run
EXPOSE 5000/tcp
CMD ["python3", "api.py"]</code>
                    </div>
                    </p>
                    <p>
                    Web Scanner container listener is just a single file application,
                    with a Scanner object that interacts with WhatWeb (web scanner)
                    and a Flask app that has two endpoints -- one to ping the microservice for dead or
                    alive signal, and the other to scan a target with the web
                    scanner. Hopefully the code is bug free, because I just wrote
                    this as I was writting this note.
                    </p>
                    <div class="pre-code" /><code>
#!/usr/bin/env python3
import json
import os
import subprocess
import uuid

from flask import Flask, jsonify, request

app = Flask(__name__)
app.secret_key = "fskjnfskd"

class Scanner(object):
    def __init__(self, ip_address):
        self.ip_address = ip_address
        self.output_file = f'{uuid.uuid4().hex}.json'

    def t2(self):
        if not os.path.exists("/scans"): 
            os.mkdirs("/scans")
        os.chdir("/src")
        # step 1
        t = subprocess.run([
            './whatweb', 
            f'{self.ip_address}', 
            f'--log-json=/scans/{self.output_file}'
        ])
        if t.returncode == 0:
            return False, t.stderr.decode("utf-8")
        # step 2
        t1 = subprocess.run(
            ['python3', 
            "-m", 
            "json.tool" 
            f'/scans/{self.output_file}'],
            text=True, 
            capture_output=True
        )
        t2 = False, None
        if t1.returncode == 0:
            t2 = True, t.stdout.decode("utf-8").strip("\n")
        else:
            t2 = False, t.stderr.decode("utf-8")
        # step 3
        if t2[0]:
            os.system(f'rm -r /scans/{self.output_file}')
        return t2

    def t1(self):
        t1 = self.t2()
        if not t1[0]:
            return False, t1[1]
        return True, json.loads(t1[1])


@app.route("/api/v1/ping", methods=["GET"])
def ping():
    return jsonify(status=True), 200


@app.route('/api/v1/scan', methods=["POST"])
def scan():
    target = request.form.get("target")
    if target is None:
        return jsonify(status=False), 400
    t1 = Scanner(target).t1()
    if not t1[0]:
        return jsonify(data=t1[1]]), 400
    return jsonify(data=t1[1]), 200


if __name__ == "__main__":
    app.run(debug=True, host="0.0.0.0", port=5000)</code>
                    </div>
                    <p>
                        Build image
                    </p>
                    <div class="pre-code"><code>
docker build --tag=scanner:latest .</code>
                    </div>
                    <p>
                        Run image
                    </p>
                    <div class="pre-code"><code>
docker run -t -d --name=web-scanner scanner:latest</code>
                    </div>

                    <p>
                    Now, this scanner is reusable container, can be added to a
                    decentralized application as a node in the network, via
                    docker-compose for example -- but first test with curl:
                    </p>
                    <div class="pre-code"><code>
curl -X POST \
    -d "target=my-test-target.org" \
    [container url - run docker network inspect bridge]:5000/api/v1/scan</code>
                    </div>
                    <p>

                        <div style="height: auto; width: auto; overflow: scroll;">
                            <img src='./static/images/gifs/scanner.gif' width=auto class="console-div"/> 
                        </div>
                        <small>
                        Test it, from up to down, screen one shows, container running,
                        screen 2 follows the logs from the container; the api logs,
                        screen 3 executes a request to that container, with a target of
                        https://reddit.com, it takes about 10 seconds to scan, then, it
                        returns a json output that be easily stored in a table row as
                        json, and displayed on frontend application.
                        </small>
                    </p>
                    <p> Ok now the docker-compose file</p>
                    <div class="pre-code"><code>
version: '3.9'

services:
   ... rest of service

   web-scanner:
     container_name: web_scanner
     build:
       context: .
       dockerfile: ./services/web_scanner/Dockerfile
     # no need for an entry command since the Dockerfile has CMD statement.
     restart: unless-stopped
     volumes:
       - ./services/web_scanner/api.py:/api.py
     networks:
       main-network:
         ipv4_address: 69.69.69.6

   ... rest of services</code>
                    </div>
                    <p>
                    Last step is to replace this on the webscanner Dockerfile
                    </p>
                    <div class="pre-code"><code>
# replace this
COPY ./scanner/api.py /api.py
# with this since the build context of the
# docker-compose is now a diferent location.
COPY ./services/webscanner/api.py /api.py</code>
                    </div>
                    <p>
                    Oh bro, we bareley made the deadline, now let's cash out and get
                    pizza!
                </div>
            </div>
            <div class="note" >
                <div class="note-title">
                    <h3>
                        A rant on implementing API's -- 
                        from pure experience, not books or
                        youtube tutorials.
                    </h3>
                </div>
                <div class="note-body">
                    In my opinion,
                    <ol>
                        <li>
                            Singleton applications are a good fit for a microservice.
                            Take sanic, Flask, etc, as examples of a single
                            application instance objects -- single files, single
                            object, micro service.
                        </li>
                        <li>
                            Monolithic applications are good if it's purpose is to be
                            *a* single micro service in a system with a network of micro services,
                            and it can be written in less than 1000 lines of
                            code, and can be reusable, and pluggable. What? I said it is my personal
                            opinion, you can call it a microservice and remove the
                            monolithic if you want, but when u find yourself writting
                            a *single file* rest api 'microservice' think about it
                            for a second.
                        </li>
                        <li>
                            Validation/Verification is always one of the first things to do,
                            if you want to provide the end user of the system with a
                            pleasant usage experience.
                        </li>
                        <li>
                            Database relations, using foreign keys to create
                            relational models, not text id's, otherwise, deletion of
                            related models is a real pain, it is important to point
                            this out to the entry level engineers.
                        </li>
                        <li>
                            Document the endpoints, check know OpenApi, leverage
                            tools like swagger -- for django or I recommend using
                            drf-yasg, and applying <code style="background:
                                                                black; color: white;">@swagger_auto_schema</code>
                            decorator with both request body, query parameter and
                            response serializers to provide accurate
                            description on what the endpoint needs for context
                            negotiation, and what it returns. You can specify all
                            status code of responses, good, leverage it, use it. Make
                            frontend team happy to work with you, and gain good
                            karma.
                        </li>

                        <li>
                            Scaling up is fucking easy, scaling down, not so much.
                        </li>
                        <li>
                            Sometimes threading is better than integrating an entire
                            task management system, for fucks sake.
                        </li>
                        <li>
                            Do not allow the entry level developer to refactor, just
                            write detailed tasks, and make him/her follow them to the
                            letter.
                        </li>
                        <li>
                            Refactor comes after v1 is stable. End of discussion.
                        </li>
                        <li>
                            Sometimes management will make the mistake of asking
                            entry level developers on estimates for tasks, correct
                            this mistake by making management understand, not all
                            engineers have the same level of skill/experience.
                            Situations like this fuck the so called 'Agile' bullshit
                            planning.
                        </li>
                        <li>
                            Work as a team, if you are a new engineer, do not be the egocentric developer,
                            there is someone else who will come and make an example
                            of you. No matter how good you are .. emm *claim to be**, 
                            you will lack expereince. Need to be battle
                            tested, that means, at leats, perhaps, going through a couple of
                            erroneous managerial estimates for high profile, big
                            investment clients. Enough suffering that will make
                            you question your carrer choices. You need to overcome
                            not having a social life, being assigned to contribute
                            to an important system and suffer because of
                            deadlines. Watching on the sidelines as losers
                            interact with your crush, while you sit, pathetic at your
                            workstation trying to make the deadline -- this is they
                            way to pacify egocentric entry level developers.
                        </li>
                        <li>
                            A good coffee machine will save you money in the long
                            run.
                        </li>
                    <ol>
                </div>
            </div>
            <div class="note" >
                <div class="note-title">
                    <h3>Celery Flower and Worker</h3>
                </div>
                <div class="note-body">
                    <p>
                    Sometimes deploying systems with asynchronous tasks is
                    required per client specifications.
                    </p>
                    <p>
                    For these instances I tend to dockerize celery redis and
                    monitor them with Flower, which provides visualization for
                    the performance of system asychronous tasks.
                    <div class="pre-code"><code>
version: '3.9'

services:
  .... rest of services (redis, etc)
  tasks:
    build:
      context: .
      dockerfile: ./docker/tasks/Dockerfile
    command: >
      sh -c "python3 -m celery -A my_system flower --address=0.0.0.0 --port=5566 &; python3 -m celery -A my_system worker -l INFO -E"
    env_file:
      - ./docker/tasks/.env
    depends_on:
      - redis
    restart: unless-stopped
    network:
    my-network:
        ipv4_address: 10.10.10.2
    expose:
      - "5566"

networks:
  ... network config</code>
                    </div>
                    <small>
                        On the command: section of the dockerfile, putting flower
                        on the background so the worker can operate normally, notice
                        the ampersand <code> & </code> and the <code> ; </code> if
                        the previous command fails, the container won't be marked as
                        <code>exited</code> by the docker daemon.
                    </small>
                    <p>
                        Usually setting up a shared task monitoring tool over public
                        http is not the best idea.

                        I pipe to my remote workstation machine all flower instances for all
                        systems using ssh
                    </p>
                    <div class="pre-code"><code>
~$ ssh -L 10.10.10.2:5566:127.0.0.1:8001 -i my_system.pem user@$MY_SYSTEM_IP</code>
                    </div>
                    <p>
                    Open browser at <code> 127.0.0.1:8001 </code> and monitor my
                    systems shared tasks, configure rate limits, etc ....
                    <br>
                    You can fine tune flower, check out their documentation
                    </p>
                </div>
            </div>
            <div class="note" >
                <div class="note-title">
                    <h3> Decided to add some vendor libs </h3>
                </div>
                <div class="note-body">
                    <p> Have been a little against loading vendor libraries to my site,
                    however, needed some syntax higlighter and added
                    <a href="https://highlightjs.org" target="_blank">highlight.js</a>
                     for better clarity.
                    </p>
                </div>
            </div>
            <div class="note">
                <div class="note-title">
                    <h3> Dicking Down IP's for good</p>
                </div>
                <div class="note-body">
                    <p>
                        IP is a standard protocol, STD 5 (Standard 5) meaning, it has
                        been approved by the IAB (Internet Advisory Board) a sort of
                        branch of the 
                        IEFT (Internet Engeneering Task Force) the one who issues the
                        standards,  as well as the IANA (Internet Assigned Board). IP is the Internet
                        Protocol, and IP number, is just a number used to id stuff on that protocol.
                    </p>
                    <p>
                        The Internet Protocol is an unreliable, connectionless packet
                        delivery protocol, and it assumes that data can be lost
                        during delivery, but since it is part of the OCI model
                        (read below) it assumes higher protocols handle the loss of
                        data during delivery aka catching errors.
                    </p>
                    <p>
                        The usage of a connectionless packet delivery method
                        tackles the issue of it depending on central computing
                        centers that use other networks models. The DOD (Department of Defence of the United States) 
                        decided to deploy a network that was best suitable to evade network distuption
                        in an unforseen event that could compromise lines of
                        communication in a certain geographical location, and so the
                        network was deployed to counter any such event, and
                        it has been proven true and works.
                    </p>
                    <p>
                        <h4> IP numbers </h4>
                        <p>
                        IP numbers are 32-bit unsigned values, they are expressed
                        like this 10.10.10.1 in a dotted decimal notation.
                        </p>   
                            IP address = {network number}-{host number}
                            <br>
                            192.2[network address].10.2[host number] 
                        <p>
                            In binary it looks like this.
                            <br>
                                11000000.00000010.00001010.00000010
                        </p>
                        <p>
                            Shortcut to convert IP nums to binary
                        </p>
                        <div class="pre-code">
<code>#!/bin/bash
# This can go inside a loop after cating file of IP's

ip=$1
temp=$(echo $ip | sed 's/\./;/g');
binary_ip=$(echo "obase=2;$temp" | bc | tr -d '\n');
printf "%d\n" $binary_ip</code>
                        </div>
                        </p>
                        <p>
                            These addresses are used by the Internet Protocol to
                            identify hosts on the internet
                            <h4> Five classes of IP addresses and it's usages +
                                brief properties </h4>
                            <ol>
                                <li>Class A - these use 7 bits of the network section
                                and 24 bits for the host section -- suitable for
                                networks with many hosts.</li>
                                <li>Class B - these use 14 bits for the network
                                    section and 16 for the host section -- suitable
                                    for networks with a medium-large number of hosts.</li>
                                <li>Class C - these use 21 bits for the network
                                    section, and 8 bits for the host section --
                                    suitable for a network with a small number of
                                    hosts.</li>
                                <li>Class D - these are used for multicasting.</li>
                                <li>Class E - these are of experimental use.</li>
                            </ol>
                        </p>
                    </p>
                </div>
            </div>
            <div class="note">
                <div class="note-title">
                    <h3>OCI Review<h3>
                </div>
                <div class="note-body">
                    <p> Open Systems Interconnection Reference Model</p>
                    <small> FOr people getting into INFOSEC, this is crucial </small>

                    <p> 
                        It is a reference for how a network protocol stack should operate.
                        Each layer provides a set of function to communicate with the
                        layer above, and it also relies on sets of function from the
                        layer below ... Vertical Communication. 
                    </p>
                    <h3>The 7 layers</h3>
                    <ol>
                        <li>
                            Application - File Transfers, Emulators, Restful APIS
                        </li>
                        <li>
                            Presentation - Formating of information or encryption
                        </li>
                        <li>
                            Session - Keep Alive Sessions
                        </li>
                        <li>
                            Transport - Reliable END 2 END transport (TCP/IP UDP Protocols, etc)
                        </li>
                        <li>
                            Network - Packet deliver, routing.
                        </li>
                        <li>
                            Data Link - Framing of information units and error
                            handling.
                        </li>
                        <li>
                            Physical - Transmission of bits on the actual hardware.
                        </li>
                    </ol>
                    <p>
                        <bold>Most</bold> applications regular users of the internet use are at
                        the Application, Presentation, and Session levels of the OCI Model.
                    </p>
                    <small> Source: IBM TCP/IP Technical Overview, Sixth Edition</small>
                </div>
            </div>
            <div class="note">
                <div class="note-title">
                    <h3> % digits deployments</h3>
                </div>
                <div class="note-body">
                    <p>
                        Deploying stuff on servers, could be just relayer api's for remote
                        RPC's on complex systems .. whatever .. 
                    </p>
                    <p>
                        If the server is not hosted on a cloud provider, then a simple
                        IPTABLES execution will do it, given the server is LInuX, can be
                        house computer, but need to modify  your router to redirect incomming
                        traffic to port whatever to machine serving IP, that machine has some
                        reverse proxy sitting infront of it.
                        <br>
                    <p> open up some ports </p>
                    <div class="pre-code"><code>
iptables -I INPUT -p tcp -m tcp --dport 80 -j ACCEPT
iptables -I INPUT -p tcp -m tcp --dport 443 -j ACCEPT</code>
                    </div>
                    </p>
                    <p> 
                        For now docker-compose example for serving a static site w nginx,
                        pretty stupid and noob, the spin are the quirks for hardening the web
                        server and scoring over a D on <code> securityheaders.org </code>,
                        and proxy log analysis for monitoring. Remoteley smart competition
                        can eat your bread by presenting a report with your application list
                        of vulnerabilities, because not many devs are security oriented, they
                        just want to turn in a job and get paid.
                    <p>
                        <bold> 
                            A compose file for the host (install docker & docker-compose)
                        </bold>
                        <script src="https://gist.github.com/xzan0x7c7/47c6d328ef4994ab9e763d6c67de51da.js"></script>
                        <small> 
                        Enabling volumes to avoid rebuilding app, and editing directly on
                        host, not on container, saves the sysadmin time. 
                        </small>
                    <p> Dockerfile located on build context nginx/Dockerfile </p>
                    <script src="https://gist.github.com/xzan0x7c7/d70df65dd94a475ef4b90c4c57ec5f8f.js"></script>
                    <p> Nginx conf file </p>
                    <script src="https://gist.github.com/xzan0x7c7/24060a789672b2f1a7d4a9cdb8a41df8.js"></script>
                    <p> 
                        <br>
                        However, I am now interested in monitoring visitors and
                        keeping track of IP's by parsing my reverse proxy logs, I don't wanna use
                        something like Dynatrace or New Relic, because I am interested in using
                        something like OpenCTI to monitor APT's on my stupid website.
                        <br><br>
                    <div class="pre-code"><code>
# dump logs 2 file
~$ docker-compose logs --follow web-server &> /var/log/web-server.log &</code>
                    </div>
                    <small> Start listening to container logs on the background, could be
                    done as a systemctl unit file, but this serves the purpose,
                    monitor this process and kill it with htop or the <code>kill</code> cmd
                    </small>
                    <br>
                    <br>
                    <p>
                        For the purpose a super simple shell or python script to parse
                        this log file works, only want something fairly stupid, which is to extract ip, with
                        datetime from the logfile, so to ship it to any analysis
                        program or system -- for further analysis, in this case further
                        processing for analysis and visualization.
                    </p>
                    <div class="pre-code"><code>
#!/bin/bash
grep -E -o "([0-9]{1,3}[\.]){3}[0-9]{1,3}\s-\s-\s\[[0-9]{1,2}\/\w+\/[0-9]{4}\:[0-9]{2}\:[0-9]{2}\:[0-9]{2}.*\]" /var/log/web-server.log > /usr/share/data/monitoring/web-server-visitors.txt</code>
                    </div>
                    <p>
                    <div style="width: auto; height: 350px;overflow: auto;">
                        <img src="./static/images/gifs/ips.gif" width=auto class="console-div"/>
                    </div>
                    <small> 
                    <code> 
                    testing the code above
                    </code>
                    </small>
                    <br>
                    <br>
                    The date can serve as a distinct reference point for entries on
                    whatever storage unit u wish to persist analysis.
                    <br><br>
                    The last step is to cook a script to load this file, and either
                    send it as a batch to another server on the same network, or,
                    another network running some api that receives this data and
                    analyses with a forensics tool like OpenCTI (open source).
                    <br>
                    <br>
                    <div class="pre-code"><code>
#!/bin/bash
curl -d @/usr/share/data/monitoring/web-server-visitors.txt http://10.0.10.2/analyze-web-server-visistors</code>
                    </div>
                    <small>
                    Either add this script with 
                    <code>
                    crontab -e
                    </code> or add it to 
                    <code> 
                    /etc/cron.hourly 
                    </code>
                    </small>
                    <br>
                    <br>
                    Malicious people would then instead of doing APT analysis, would
                    stupidly use a tool like nmap or greenbone to scan that IP for
                    open ports, and do recoinassance on visitors, for further
                    malicious activity.
                    </p>
                    </p>
                </div>
            </div>
            <div class="note">
                <div class="note-title">
                    <h3>
                        <span class="trans-style">Big Diference </span>
                    </h3>
                </div>
                <div class="note-body">
                    <p>
                        Big fucking difference in between a transexual and a transvestite you
                        fucking ignorant piece of shit. A 
                        <span class="trans-style">transexual</span> 
                        is someone who medically transitions via cellular genetic hack through modifying
                        protein synthesis via hormonal replacement therapy, developing
                        goodies like tits and femenine fat redistribution as well as soft
                        skin and cute face, female body smell, etc.. ........ and transvestite is
                        someone who just dresses like a female for the thrill of it ... I
                        can't make a single motherfucker out of 10 of you idiots -- If I was
                        the dad of any of you I would be ASHAMED of you -- HAIL SATAN BITCH!!
                    </p>
                </div>
            </div>
            <div class="note">
                <div class="note-title">
                    <h3>
                        Infected 0 trust
                    </h3>
                </div>
                <div class="note-body">
                    <p>
                        Assume everything is infected by applying a 0 trust policy, every component, switch, router is infected,
                        the internet is infected with satanic methods designed to influence
                        your choice of actions, BlaK Ops zecTS owns your shit.
                    </p>
                </div>
            </div>
            <div class="note">
                <div class="note-title">
                    <h3>
                        Pathetic
                    </h3>
                </div>
                <div class="note-body">
                    <p>
                        Do you know how pathetic you are not trying to be something you are not?
                    </p>
                </div>
            </div>
            <div class="note">
                <div class="note-title">
                    <h3> It's not that I hate you.</h3>
                </div>
                <div class="note-body">
                    <p> 
                        I don't hate you, it's only that you have proven to be a
                        piece of crap to everyone you are/were close to. 
                        <br>
                        <br>
                        How in the fuck will I ever consider any sort of relationship
                        with you if all you do is hate on your own people?
                    </p>
                </div>
            </div>
            <div class="note">
                <div class="note-title">
                    <h3> Chronically Alive</h3>
                </div>
                <div class="note-body">
                    <p>
                        GET FUCKING HELP YOU DEMENTED MANIPULATIVE SNAKE 
                    </p>
                </div>
            </div>
            <div class="note">
                <div class="note-title">
                    <h3> Nonesense</h3>
                </div>
                <div class="note-body">
                    <p>
                        Do you have really bad autism, to the point were you screeeeeam!!!!
                        fucking lound when the salad dressing touches the meat on a plate? 
                    </p>
                </div>
            </div>
            <div class="note">
                <div class="note-title">
                    <h3>You bore me.</h3>
                </div>
                <div class="note-body">
                    <p> 
                        You bore me with academic linguistics.
                        <br>
                        <span class="snake-style">
                        ~$ systemctl disable your-ass.service && rm -v /etc/system/systemd/your-ass.service
                        </span>
                        </code>
                    </p>
                </div>
            </div>
            <div class="note">
                <div class="note-title">
                    <h3>  management, systems, django .. BORING </h3>
                </div>
                <div class="note-body">
                    <p> 
                        Sometimes u just don't want to add 3rd party packages to handle crons
                        for backend web api's that run on python and django, so here is a STUPID
                        way of doing it. Add stuff to 
                        <code>/etc/cron.daily</code> 
                        or 
                        <code> /etc/cron.hourly </code>
                    </p>
                    <script src="https://gist.github.com/xzan0x7c7/3a065ca7bf0e93eed85e8757b97a968e.js"></script>
                </div>
            </div>
        </div>
        <!-- end of notes -->
        <script src="./static/vendors/js/highlight.min.js"></script>
        <script>
            document.addEventListener("DOMContentLoaded", function() {

                var state = {
                    "mode" : "red",
                    "holder" : {}
                }
                
                class Sucy {
                    constructor(height, width) {
                        this.height = height
                        this.width = width
                        this.imageSrc = './static/images/gifs/imp.gif'
                        this.sucy = null
                    }

                    init() {
                        var e1 = document.createElement("div")
                        var e2 = document.createElement("img")
                        e1.style.display = "none"
                        e2.src = this.imageSrc
                        e2.style.height = this.height
                        e2.style.width = this.width
                        this.sucy = e1
                    }
                    
                    s1() {

                    }

                    main() {
                        this.init()
                        this.s1()
                    }
                }

                function modeSwitch() {
                    var t = document.getElementById("dark-mode-trigger")
                    t.addEventListener("click", function(e) {
                        if (state.mode == "red") {
                            t.innerText = "Red mOde"
                            state.mode = "dark"
                            setMode()
                        } else {
                            t.innerText = "Dark mOde"
                            state.mode = "red"
                            setMode()
                        }
                    })
                }
                
                function setMode() {
                    var t = document.getElementsByTagName("body")[0];
                    if (state.mode == "dark") {
                        t.style.background = "black";
                    } else {
                        t.style.background = "crimson";
                    }
                }
                
                function setHj() {
                    document.querySelectorAll('.pre-code code').forEach((el) => {
                        hljs.highlightElement(el);
                    });
                }
                
                function i1() {
                    var notes = document.getElementsByClassName("note");
                    for (let i = 0; i < notes.length; i++) {
                        var t1 = notes[i]
                        var t2 = t1.children[0]
                        var d1 = document.createElement("div")
                        var sl = document.createElement("div")
                        var sr = document.createElement("div")
                        var g1 = document.createElement("img")
                        var g2 = document.createElement("img")
                        d1.classList.add("flex")
                        d1.classList.add("flex-row")
                        d1.classList.add("space-between")
                        g1.height = 25; g1.width = 25;
                        g2.height = 25; g2.width = 25;
                        g1.src = "./static/images/gifs/me.gif"
                        g2.src = "./static/images/gifs/me.gif"
                        d1.appendChild(sl)
                        d1.appendChild(sr)
                        if (i % 2 == 0) {
                            sl.classList.add("signature-left");
                            sl.appendChild(g1)
                        } else {
                            sr.classList.add("signature-right");
                            sr.appendChild(g2)
                        }
                        t1.insertBefore(d1, t2)
                    }
                }
                
                function i2() {
                    var t1 = document.getElementById("g-1")
                    var t2 = document.getElementById("g-2")
                    var t3 = document.getElementById("g-9")
                    if (t1.style.color == "black") {
                        t1.style.color = "fuchsia"
                    } else {
                        t1.style.color = "black"
                    }
                    if (t2.style.color == "black") {
                        t2.style.color = "fuchsia"
                    } else {
                        t2.style.color = "black"
                    }
                    if (t3.style.color == "black") {
                        t3.style.color = "limegreen"
                    } else {
                        t3.style.color = "black"
                    }
                }
                
                function s1s() {
                    // set intervals here
                    window.setInterval(i2, 666)
                }

                function ri() {
                    // remove intervals here
                    window.clearInterval(i2);
                }
                
                function main() {
                    s1s()
                    modeSwitch()
                    setHj()
                    i1()
                    // remove intervals to avoid leaks
                    window.onbeforeunload = ri;
                }

                main()
            })
        </script>
    </body>
</html>
