<html>
    <head>
        <title>React/React Native Http Interceptor.</title>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="description" content="My dump">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="/static/css/main.css" />
        
    </head>
    <body>
        <header>
            <h2> <a style="text-decoration: none;"href="/">Notes</a></h2>
        </header>
        
    <div class="note">
        <div class="note-title">
            <h3>React/React Native Http Interceptor.</h3>
            <p>Date: 2023-11-13<br>By: csr13</p>
        </div>
        <div class="note-body">
            <p>When developing user based mobile application or web applications and using JWTokens
for authentication, there is the need to always return the user when the backend
returns a not authenticated response -- wether is to do a token refresh or a session
expiration action e.g: session token expires user needs to log in again.</p>
<p>This is a simple http interceptior that can be used when developing Mobile
Applications and Web Applications that handle user actions e.g: social media.</p>
<p><code>AuthService</code> has some helper methods, self explanatory.</p>
<pre><code class="language-javascript">import axios from &quot;axios&quot;;
import AuthService from &quot;./auth.service&quot;;

const redirect = (url, clear = false) =&gt; {
  if (clear) {
    window.localStorage.clear();
  }
  window.location.href = url;
};

const token_expired = () =&gt; {
  var user = AuthService.decode_user();
  if (!user.exp) {
    redirect(&quot;/login&quot;, false);
  }
  if (new Date(user.exp * 1000) &lt; new Date()) {
    return true;
  }
  return false;
};

const Interceptor = axios.interceptors.response.use(
  (response) =&gt; {
    if (token_expired()) {
      redirect(&quot;/login&quot;, true);
    }

    if (response.status === 401) {
      redirect(&quot;/login&quot;, true);
    } else if (response.status === 403) {
      redirect(&quot;/login&quot;, true);
    }
    return response;
  },
  (error) =&gt; {
    if (error.response &amp;&amp; error.response.status === 401) {
      redirect(&quot;/login&quot;, true);
    } else if (error.response &amp;&amp; error.response.status === 403) {
      redirect(&quot;/login&quot;, true);
    }
    return error;
  }
);

export default Interceptor;
</code></pre>
        </div>
    </div>

        
        <script src="/static/js/main.js"></script>
    </body>
</html>