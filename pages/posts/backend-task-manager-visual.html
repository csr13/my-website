<html>
    <head>
        <title>Backend Celery task manager dashboard via Flower</title>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="description" content="My dump">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="/static/css/main.css" />
        
    </head>
    <body>
        <header>
            <h2> <a style="text-decoration: none;"href="/">Notes</a></h2>
        </header>
        
    <div class="note">
        <div class="note-title">
            <h3>Backend Celery task manager dashboard via Flower</h3>
            <p>Date: 2023-10-29<br>By: csr13</p>
        </div>
        <div class="note-body">
            <p>Sometimes deploying systems with asynchronous tasks is
required per client specifications.</p>
<p>For these instances I tend to dockerize celery redis and
monitor them with Flower, which provides visualization for
the performance of system asychronous tasks.
version: '3.9'</p>
<pre><code>services:
  .... rest of services (redis, etc)
  tasks:
    build:
      context: .
      dockerfile: ./docker/tasks/Dockerfile
    command: &gt;
      sh -c &quot;python3 -m celery -A my_system flower --address=0.0.0.0 --port=5566 &amp;; python3 -m celery -A my_system worker -l INFO -E&quot;
    env_file:
      - ./docker/tasks/.env
    depends_on:
      - redis
    restart: unless-stopped
    network:
    my-network:
        ipv4_address: 10.10.10.2
    expose:
      - &quot;5566&quot;

networks:
  ... network config
</code></pre>
<p><small>
On the command: section of the dockerfile, putting flower
on the background so the worker can operate normally, notice
the ampersand <code> &amp; </code> and the <code> ; </code> if
the previous command fails, the container won't be marked as
<code>exited</code>by the docker daemon.
</small></p>
<p>Usually setting up a shared task monitoring tool over public
http is not the best idea.</p>
<p>I pipe to my remote workstation machine all flower instances for all
systems using ssh</p>
<pre><code>~$ ssh -L 10.10.10.2:5566:127.0.0.1:8001 -i my_system.pem user@$MY_SYSTEM_IP
</code></pre>
<p>Open browser at <code>127.0.0.1:8001</code> and monitor my
systems shared tasks, configure rate limits, etc ....
You can fine tune flower, check out their documentation</p>
        </div>
    </div>

        
        <script src="/static/js/main.js"></script>
    </body>
</html>